---
import Layout from "@layouts/Layout.astro";
import Cover from "@components/project/Cover.astro";
import Information from "@components/project/Information.astro";

import { getAdjacentElements } from "@utils/array.utils";

import { getCollection } from "astro:content";
import { getEntries } from "astro:content";

// Generate a new path for every project
export async function getStaticPaths() {
	const projects = await getCollection("project");
	return projects.map((entry, index) => ({
		params: { slug: entry.slug },
		props: {
			entry,
			prev: getAdjacentElements(projects, index)[0],
			next: getAdjacentElements(projects, index)[1],
		},
	}));
}

const { entry, prev, next } = Astro.props;

// Get project's video src
const videoFiles: any = import.meta.glob("/src/content/project/*/*.mp4", { eager: true });
const videoFile: string = videoFiles[`/src/content/project/${entry.slug}/${entry.data.video?.src}`]?.default;
const videoSource = videoFile && entry.data.video?.type === "video/mp4" ? videoFile : (entry.data.video?.src as string);
---

<Layout title={`Orama Production â€“ ${entry.data.title}`} description={entry.data.description} theme="dark">
	<Cover title={entry.data.title} cover={entry.data.cover} videoType={entry.data.video?.type} videoSrc={videoSource} />
	<Information title={entry.data.title} description={entry.data.description} year={entry.data.year} type={entry.data.type} client={entry.data.client} credits={entry.data.credits} />
</Layout>